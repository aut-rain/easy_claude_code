# Claude Code 完整使用教程：从入门到精通

## 目录

1. [Claude Code 简介](#1-claude-code-简介)
2. [安装与设置](#2-安装与设置)
   - 2.1 [安装 Claude Code](#21-安装-claude-code)
   - 2.2 [登录认证](#22-登录认证)
   - 2.3 [配置与设置](#23-配置与设置)
3. [基础使用流程](#3-基础使用流程)
   - 3.1 [启动 Claude Code 会话](#31-启动-claude-code-会话)
   - 3.2 [询问第一个问题](#32-询问第一个问题)
   - 3.3 [首次代码变更](#33-首次代码变更)
   - 3.4 [利用 Git 工作流](#34-利用-git-工作流)
   - 3.5 [调试与新增功能](#35-调试与新增功能)
4. [常见工作流程](#4-常见工作流程)
   - 4.1 [理解新代码库](#41-理解新代码库)
   - 4.2 [高效修复 Bug](#42-高效修复-bug)
   - 4.3 [代码重构](#43-代码重构)
   - 4.4 [编写测试](#44-编写测试)
   - 4.5 [创建 Pull Request](#45-创建-pull-request)
   - 4.6 [处理文档](#46-处理文档)
5. [高级功能与技巧](#5-高级功能与技巧)
   - 5.1 [斜杠命令与自定义命令](#51-斜杠命令与自定义命令)
   - 5.2 [钩子 (Hooks)](#52-钩子-hooks)
   - 5.3 [插件与 MCP](#53-插件与-mcp)
   - 5.4 [使用 Plan 模式](#54-使用-plan-模式)
   - 5.5 [让 Claude 面试你](#55-让-claude-面试你)
   - 5.6 [并行会话与 Git Worktree](#56-并行会话与-git-worktree)
   - 5.7 [作为 Unix 工具使用](#57-作为-unix-工具使用)
   - 5.8 [控制输出格式](#58-控制输出格式)
6. [最佳实践](#6-最佳实践)
   - 6.1 [优化设置（CLAUDE.md 文件）](#61-优化设置claudemd-文件)
   - 6.2 [明确具体地提出请求](#62-明确具体地提出请求)
   - 6.3 [分步指导复杂任务](#63-分步指导复杂任务)
   - 6.4 [先让 Claude 探索](#64-先让-claude-探索)
   - 6.5 [使用快捷键](#65-使用快捷键)
   - 6.6 [利用 Plan 模式减少风险](#66-利用-plan-模式减少风险)
   - 6.7 [为敏感数据使用 MCP](#67-为敏感数据使用-mcp)
   - 6.8 [使用 CLI 工具而非 MCP](#68-使用-cli-工具而非-mcp)
   - 6.9 [团队协作标准化](#69-团队协作标准化)
   - 6.10 [持续学习和实验](#610-持续学习和实验)
7. [故障排除](#7-故障排除)
   - 7.1 [安装相关问题](#71-安装相关问题)
   - 7.2 [权限与认证问题](#72-权限与认证问题)
   - 7.3 [配置文件问题](#73-配置文件问题)
   - 7.4 [性能与稳定性问题](#74-性能与稳定性问题)
   - 7.5 [搜索与发现相关问题](#75-搜索与发现相关问题)
   - 7.6 [IDE 集成相关问题](#76-ide-集成相关问题)
   - 7.7 [其他问题](#77-其他问题)
8. [总结](#8-总结)

## 1. Claude Code 简介

**Claude Code** 是 Anthropic 推出的一款智能编程助手，它运行在你的终端中，能够理解你的代码库，并通过自然语言命令来执行日常任务、解释复杂代码、管理 Git 工作流等。Claude Code 的核心优势在于其强大的代码库理解能力和上下文感知能力：它无需你手动上传文件，就能自动读取并分析项目结构，为你的开发任务提供精准的代码建议和自动化支持。与传统的 AI 编程工具不同，Claude Code 并非简单的代码补全引擎，而是一个具备代理（Agentic）能力的编程助手，可以自主决策如何完成任务，并与你进行多轮交互以逐步完善解决方案。

使用 Claude Code，你可以通过自然语言描述来实现从需求到代码的转化。例如，你只需用英语告诉 Claude Code "添加一个用户注册表单"，它就会规划实现方案，编写相应的前端和后端代码，并确保其正常工作。这种能力使 Claude Code 成为开发者的"虚拟编程伙伴"，能够显著提升开发效率，将更多的创意转化为代码。Claude Code 还擅长处理繁琐的开发流程，如自动修复 Lint 错误、解决 Git 合并冲突、生成发布说明等，帮助开发者将更多精力投入到核心逻辑和创意实现上。

Claude Code 设计简洁，遵循 Unix 哲学，具有高度的可组合性和可脚本化特性。这意味着你可以将其灵活地集成到现有的开发工作流中，甚至通过管道（pipe）将其他工具的输出传递给 Claude Code 处理。同时，Claude Code 提供企业级的安全与合规支持，支持通过 Claude API 或在 AWS/GCP 等云平台上运行，满足团队协作和企业部署的需求。目前，Claude Code 在 GitHub 上拥有超过 **58.2k** 的 Star 和 **4.3k** 的 Fork，受到全球开发者的广泛关注。

## 2. 安装与设置

### 2.1 安装 Claude Code

在开始使用 Claude Code 之前，你需要先安装它。Claude Code 可以通过 npm 包管理器进行安装，也可以通过 Cursor 等工具引导安装。

#### 前提条件

- 需要安装 Node.js 18 或更新版本环境
- Windows 用户还需安装 Git for Windows

#### 方法一：npm 安装（推荐）

使用以下命令通过 npm 全局安装 Claude Code：
```bash

npm install -g @anthropic-ai/claude-code

```
安装完成后，运行以下命令查看版本，若显示版本号则表示安装成功：
```bash

claude --version

```
#### 方法二：Cursor 引导安装

如果你不熟悉 Node.js 且有 Cursor，可以在 Cursor 中输入以下命令，Cursor 会引导你完成 Claude Code 的安装：
```

Help me install Claude Code

```
或者访问官方文档获取详细指导：[Claude Code 概览 - Claude Code Docs](https://code.claude.com/docs/zh-CN/overview)

#### 注意事项

- 如果在安装过程中遇到权限问题，请尝试使用 `sudo`（MacOS/Linux）或以管理员身份运行命令提示符（Windows）重新执行安装命令
- 安装成功后，还需进行后续配置步骤，若直接使用 `claude` 命令启动，可能由于网络或地区限制无法使用

### 2.2 配置 GLM Coding Plan

安装完成后，需要配置 GLM Coding Plan 套餐才能正常使用。配置过程包括注册账号、获取 API Key 和配置环境变量三个步骤。

#### 步骤一：注册账号

访问[智谱开放平台](https://open.bigmodel.cn/)，点击右上角的「注册/登录」按钮，按照提示完成账号注册流程 。

#### 步骤二：获取 API Key

登录后，在个人中心页面，点击「API Keys」，创建一个新的 API Key。请妥善保管你的 API Key，不要泄露给他人，也不要直接硬编码在代码中。

#### 步骤三：配置环境变量

通过设置环境变量来配置 GLM Coding Plan，有以下三种方式可选：

##### 方式一：自动化助手

使用 Coding Tool Helper 快速完成配置：
```bash

npx @z_ai/coding-helper

```
按照界面提示操作即可自动完成工具安装、套餐配置和 MCP 服务器管理等。详细说明请参考 [一键安装小助手 - 智谱AI开放文档](https://docs.bigmodel.cn/cn/coding-plan/extension/coding-tool-helper) 文档。

##### 方式二：自动化脚本

仅支持 MacOS 和 Linux 环境，在终端或 IDE 中运行以下命令：
```bash

curl -O “https://cdn.bigmodel.cn/install/claude_code_env.sh” && bash ./claude_code_env.sh

```
脚本会自动修改 `~/.claude/settings.json` 来配置环境变量，并在 `~/.claude.json` 添加必要参数。

##### 方式三：手动配置

支持 MacOS、Linux 和 Windows，需手动修改配置文件。

**1. 配置 settings.json**

根据不同系统，编辑或新增对应的 `settings.json` 文件：

- **MacOS & Linux**: `~/.claude/settings.json`
- **Windows**: `用户目录/.claude/settings.json`

添加或修改 `env` 字段：
```json

{
	“env”: {
		“ANTHROPIC_AUTH_TOKEN”: “your_zhipu_api_key”,
		“ANTHROPIC_BASE_URL”: “https://open.bigmodel.cn/api/anthropic” ,
		“API_TIMEOUT_MS”: “3000000”,
		“CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC”: 1
	}
}

```
**注意：** 请将 `your_zhipu_api_key` 替换为你在步骤二获取的实际 API Key。

**2. 配置 .claude.json**

编辑或新增 `.claude.json` 文件：

- **MacOS & Linux**: `~/.claude.json`
- **Windows**: `用户目录/.claude.json`

添加以下参数：
```json

{
	“hasCompletedOnboarding”: true
}

```
**重要提示：** 

- 配置文件需保证 JSON 格式正确性（比如不能少逗号或多逗号）
- 配置成功后，请确保重新打开一个新的终端窗口，以便环境配置生效

### 2.3 开始使用 Claude Code

配置完成后，按照以下步骤开始使用：

1. **进入代码工作目录**：在终端中导航到你的项目目录

2. **启动 Claude Code**：执行以下命令
```bash

claude

```
3. **确认 API Key 使用**：如果遇到「Do you want to use this API Key」的提示，选择 Yes 即可

4. **信任文件访问**：启动后选择信任 Claude Code 访问文件夹里的文件

配置完成！现在就可以正常使用 Claude Code 进行开发了。

### 2.4 模型配置说明

Claude Code 内部模型环境变量与 GLM 模型对应关系，默认配置如下：

- `ANTHROPIC_DEFAULT_OPUS_MODEL`：GLM-4.7
- `ANTHROPIC_DEFAULT_SONNET_MODEL`：GLM-4.7  
- `ANTHROPIC_DEFAULT_HAIKU_MODEL`：GLM-4.5-Air

一般情况下，不需要手动调整模型映射。默认配置采用服务端模型映射，即界面上显示的是 Claude 模型但实际使用的是 GLM 模型，这样可以确保自动更新到最新模型。

如需切换模型，可以通过修改 `~/.claude/settings.json` 文件添加或替换以下环境变量：
```json

{
	“env”: {
		“ANTHROPIC_DEFAULT_HAIKU_MODEL”: “glm-4.5-air”,
		“ANTHROPIC_DEFAULT_SONNET_MODEL”: “glm-4.7”,
		“ANTHROPIC_DEFAULT_OPUS_MODEL”: “glm-4.7”
	}
}

```
启动新的命令行窗口，运行 `claude` 启动 Claude Code，然后在 Claude Code 中输入 `/status` 确认模型状态。

### 2.5 常见问题排查

#### 手动修改配置不生效

如果手动修改了 `~/.claude/settings.json` 配置文件但发现配置没有生效，可以尝试以下排查步骤：

1. 关闭所有 Claude Code 窗口，重新打开一个新的命令行窗口，再次运行 `claude` 启动
2. 如果问题仍然存在，尝试删除 `~/.claude/settings.json` 文件，然后重新配置环境变量
3. 确认配置文件的 JSON 格式是否正确，检查变量名称是否正确，不能少逗号或多逗号，可以使用在线 JSON 校验工具进行检查

#### 推荐的 Claude Code 版本

建议使用最新版本的 Claude Code，可以通过以下命令检查当前版本和升级：
```bash

# 检查当前版本

claude --version

# 升级到最新版本

claude update

```
在 Claude Code 2.0.14 等版本已验证可正常工作。

#### 配置文件位置说明

- **MacOS & Linux**:
  - 设置文件：`~/.claude/settings.json`
  - 配置文件：`~/.claude.json`
  
- **Windows**:
  - 设置文件：`用户目录/.claude/settings.json`
  - 配置文件：`用户目录/.claude.json`

通过以上配置步骤，你就完成了 Claude Code 与 GLM Coding Plan 的集成配置，可以开始享受更高效的编程体验了。

## 3. 基础使用流程

在本节中，我们将通过一个简单的示例演示 Claude Code 的基本使用流程，帮助你快速上手。假设你已经按照上一节完成了安装和登录，现在有一个代码项目需要开发或维护。

### 3.1 启动 Claude Code 会话

首先，打开终端并导航到你的项目目录。例如：
```bash

cd /path/to/your/project

```
然后运行 `claude` 命令启动 Claude Code 的交互式会话【3†source】：
```bash

claude

```
首次运行时，你会看到 Claude Code 的欢迎界面，其中会显示你的会话信息、最近的对话以及最新更新。此时，你可以输入 `/help` 查看所有可用的斜杠命令，或输入 `/resume` 恢复上一次的对话。如果是新安装，`/resume` 可能没有任何内容。

### 3.2 询问第一个问题

现在，让我们从了解你的代码库开始。你可以直接向 Claude Code 提问，例如：
```bash

> 这个项目是做什么的？

```
Claude Code 会读取你项目中的文件（如 `README`、主要源代码文件等），然后为你总结这个项目的用途和功能。你也可以提出更具体的问题，例如：
```bash

> 这个项目使用了哪些技术？
> 主要的入口文件在哪里？
> 解释一下文件夹的结构

```
Claude Code 都会根据你的代码库内容给出回答。这种能力使得快速上手一个新项目变得非常容易。

此外，你还可以向 Claude Code 询问它自己的能力。例如：
```bash

> Claude Code 能做什么？
> 如何使用斜杠命令？
> Claude Code 能和 Docker 一起工作吗？

```
Claude Code 会解释它支持的功能，例如它能执行命令、修改文件、运行 Git 操作等。它还会说明如何使用斜杠命令来执行特定任务，以及它是否支持与你项目中的工具（如 Docker）交互。

### 3.3 首次代码变更

接下来，让 Claude Code 执行一些实际的编码任务。假设你想在项目的**主文件**中添加一个简单的功能，例如一个打印 "Hello, World!" 的函数。你可以直接用自然语言告诉 Claude Code：
```bash

> 在主文件中添加一个 hello world 函数

```
Claude Code 会首先定位到项目的主文件（例如 Python 项目中的 `main.py`，Node.js 项目中的 `index.js`），然后显示它计划进行的更改【3†source】。例如，它可能会展示类似以下的内容：
```diff

- def hello_world():

-   print("Hello, World!")
```

在 Claude Code 进行实际修改之前，**它总是先征求你的许可**。你可以选择批准这个更改，或者选择"全部批准"模式，让 Claude Code 在当前会话中自动应用后续的所有更改而不必每次确认。这种设计确保了你对代码变更拥有完全的控制权，避免意外的修改。

一旦你批准，Claude Code 就会修改主文件，添加相应的函数代码。你可以继续让它做更多的事情，例如：
```bash


> 为主函数添加一个调用 hello_world 的入口

```
Claude Code 会根据你的指示更新代码。通过这种交互方式，你可以像和一个经验丰富的同事对话一样，逐步完成代码的编写和修改。

### 3.4 利用 Git 工作流

Claude Code 对 Git 工作流有原生支持，你可以用自然语言命令它来执行常见的 Git 操作。例如，你可以问：
```bash

> 我修改了哪些文件？

```
Claude Code 会列出当前工作目录中被修改的文件列表。接着，你可以让它提交更改：
```bash

> 提交我的更改，写一条描述性的提交信息

```
Claude Code 会自动运行 `git add` 添加所有更改，然后撰写一条清晰的提交信息并执行 `git commit`。你也可以让 Claude Code 做更复杂的 Git 操作，例如：
```bash

> 创建一个新分支 feature/quickstart
> 显示最近 5 次提交
> 帮我解决合并冲突

```
Claude Code 能够理解这些指令并调用相应的 Git 命令来完成。对于合并冲突等复杂情况，Claude Code 会根据上下文分析冲突内容，并提供解决建议，帮助你顺利完成合并。

### 3.5 调试与新增功能

在日常开发中，你经常会遇到 bug 或需要实现新功能。Claude Code 在这方面同样可以大显身手。你可以用自然语言描述问题或需求，让 Claude Code 来处理。

#### 调试 Bug：

如果你遇到了错误，可以直接把错误信息或错误现象告诉 Claude Code。例如：
```bash

> 我在运行单元测试时遇到了一个错误

```
或者
```bash

> 修复用户提交表单后出现的一个 bug

```
Claude Code 会根据你的描述定位到相关代码，分析问题原因，并提出修复方案。它可能会修改代码、添加日志，甚至运行测试来验证修复效果。在得到你的许可后，Claude Code 会应用这些更改，从而解决 bug。

#### 实现新功能：

对于新需求，你也可以用英语描述。例如：
```bash

> 为用户注册表单添加输入验证

```
Claude Code 会理解你的需求，查找相关的前端和后端代码，并实现相应的验证逻辑。它可能需要多轮对话来明确细节，但最终会生成可用的代码。你还可以要求它为这个功能编写单元测试，或更新文档等，让整个流程更加完整。

## 4. 常见工作流程

Claude Code 能够胜任多种常见的开发工作流程。在本节中，我们将介绍一些典型场景，并提供相应的命令示例，帮助你更好地利用 Claude Code 提高效率。

### 4.1 理解新代码库

当你加入一个新项目或接手一个陌生的代码库时，快速理解其结构和功能是非常重要的。Claude Code 能够成为你的"代码导游"，帮助你迅速上手。

#### 获取代码库概览：

你可以直接让 Claude Code 为你提供一个项目概览：
```bash

> 给我这个代码库的概览

```
Claude Code 会阅读项目中的主要文件，为你总结项目的架构、主要模块和功能。你可以进一步询问具体细节，例如：
```bash

> 这个项目使用了哪些技术栈？
> 解释一下主要的架构模式
> 数据库模型是怎样的？

```
这些对话能帮助你快速建立对项目的整体认知。

#### 定位相关代码：

如果你需要实现或修改某个特定功能，Claude Code 可以帮助你找到相关的代码。例如：
```bash

> 找到处理用户认证的文件

```
Claude Code 会列出与认证相关的文件，并解释它们各自的职责。你还可以进一步询问这些文件如何协同工作，例如：
```bash

> 这些认证文件是如何一起工作的？

```
这样，你就能理解认证流程在整个系统中的运作方式。

#### 分析执行流程：

当你要调试一个涉及多个组件的问题时，让 Claude Code 追踪执行流程会很有帮助。例如：
```bash

> 跟踪从前端到数据库的登录流程

```
Claude Code 会从登录表单提交开始，逐步分析后端的处理逻辑，直到数据库查询，为你展示整个流程。这对于理解复杂系统的运作非常有用。

### 4.2 高效修复 Bug

修复 bug 是开发过程中的家常便饭，Claude Code 可以帮助你更快地定位并修复问题。

#### 共享错误信息：

当你遇到错误时，可以直接把错误消息或堆栈跟踪告诉 Claude Code。例如：
```bash

> 我在运行单元测试时遇到了一个错误

```
Claude Code 会分析错误信息，并在代码库中查找可能的原因。你也可以提供复现步骤：
```bash

> 提交表单后出现错误，错误信息是 “Invalid input”

```
这些信息能帮助 Claude Code 更准确地定位问题。

#### 获取修复建议：

找到问题后，你可以让 Claude Code 提供修复方案：
```bash

> 给出几种修复该 bug 的方法

```
Claude Code 会分析代码上下文，提供一种或多种可行的修复思路。你可以选择其中一种，让 Claude Code 实施修复。

#### 应用修复：

在确认修复方案后，你可以让 Claude Code 直接修改代码：
```bash

> 应用你建议的修复

```
Claude Code 会按照你的指示修改相关代码。如果涉及多个文件，它会逐步进行，并在每次修改前征求你的许可。修复完成后，你可以要求 Claude Code 运行测试来验证修复效果：
```bash

> 运行测试，确保修复有效

```
通过这种方式，你可以让 Claude Code 自动完成大部分繁琐的调试工作，从而更快地解决问题。

### 4.3 代码重构

随着项目的发展，代码可能需要重构以采用更现代的模式或更清晰的结构。Claude Code 可以帮助你安全地进行重构。

#### 识别遗留代码：

你可以让 Claude Code 帮你找出需要重构的部分。例如：
```bash

> 找出代码库中使用已弃用 API 的地方

```
Claude Code 会扫描代码，列出所有使用了已弃用接口的位置。你也可以让它寻找需要优化的模块：
```bash

> 找出性能可能较差的代码段

```
这能帮助你确定重构的优先级。

#### 获取重构建议：

对于需要重构的代码，你可以让 Claude Code 提供改进方案：
```bash

> 给出重构 utils.js 的建议，使用现代 JavaScript 特性

```
Claude Code 会分析现有代码，并给出一个利用最新语言特性的重构方案。你可以询问这样做的好处，以及是否需要保持向后兼容等。

#### 执行重构：

在确认重构方案后，你可以让 Claude Code 开始重构：
```bash

> 开始重构 utils.js

```
Claude Code 会按照建议逐步修改代码。你可以要求它分步进行，并在每一步进行测试，以确保重构过程中不会引入新的 bug：
```bash

> 分步进行，每一步都运行测试

```
这种增量式的重构方式能最大限度地降低风险。

#### 验证重构结果：

重构完成后，你可以让 Claude Code 运行完整的测试套件来验证功能是否仍然正常：
```bash

> 运行所有测试，确保重构没有破坏任何功能

```
Claude Code 会执行测试，并报告结果。如果有测试失败，它会进一步分析原因并修复，确保重构后的代码既现代化又稳定可靠。

### 4.4 编写测试

编写和维护测试是保证代码质量的重要环节。Claude Code 可以帮助你生成测试代码、运行测试并修复测试失败，从而让测试驱动开发（TDD）变得更容易。

#### 生成测试代码：

你可以让 Claude Code 为某个功能编写单元测试。例如：
```bash

> 为计算器函数编写单元测试

```
Claude Code 会分析这些函数的逻辑，并生成相应的测试用例，覆盖正常情况和边界情况。你还可以指定测试框架，例如：
```bash

> 使用 pytest 为这个 Python 模块编写单元测试

```
Claude Code 会根据你指定的框架风格来生成测试代码。

#### 运行测试：

编写完测试后，你可以让 Claude Code 运行测试以检查功能是否正常：
```bash

> 运行单元测试

```
Claude Code 会调用项目的测试命令（例如 `npm test`、`pytest` 等），并收集测试结果。如果有测试失败，它会进一步分析失败原因，并尝试修复代码。例如：
```bash

> 有两个测试失败了，分析原因并修复

```
Claude Code 会查看失败的测试用例，定位到相关代码，并修改代码以使测试通过。这种迭代过程可以大大提高开发效率，减少手动调试的时间。

#### 覆盖率和质量：

Claude Code 还可以帮助你评估测试覆盖率，并改进测试质量。例如：
```bash

> 检查测试覆盖率，并为覆盖率低的模块添加更多测试

```
Claude Code 会生成覆盖率报告，并为未充分测试的模块编写额外的测试用例。你还可以要求它进行**安全审计**，例如：
```bash

> 对待提交的代码进行安全审计，并修复发现的问题

```
Claude Code 会使用内置的安全检查机制或配置好的子代理，检查代码中的潜在安全问题，并提出修复建议。通过这些手段，Claude Code 能帮助你建立一套完善的测试和质量保障流程。

### 4.5 创建 Pull Request

在团队协作开发中，Pull Request (PR) 是代码审查和合并的重要环节。Claude Code 可以帮助你自动化 PR 的创建过程，并确保 PR 的质量。

#### 创建 PR：

当你完成功能开发并准备好提交时，可以让 Claude Code 为你创建 PR：
```bash

> 为当前的更改创建一个 Pull Request

```
Claude Code 会使用 Git 操作创建一个新分支，提交你的更改，并调用 GitHub 的 API 或 CLI 工具来创建 PR。它还会根据你的更改自动生成一个描述性的 PR 标题和正文，以便审阅者了解变更内容。

#### 代码审查：

在创建 PR 之前，你也可以让 Claude Code 对你的更改进行审查：
```bash

> 审查我的更改，并提出改进建议

```
Claude Code 会分析你修改的代码，检查代码风格、潜在 bug 和性能问题等，并给出改进意见。你可以根据这些建议进一步完善代码，然后再提交 PR。

#### 处理 PR 评论：

如果 PR 提交后审阅者提出了评论或修改建议，Claude Code 也可以帮助你处理。例如：
```bash

> 查看最近一个 PR 的评论

```
Claude Code 会显示 PR 上的评论列表。你可以让 Claude Code 针对某条评论进行修改：
```bash

> 修复评论 #123 中提到的问题

```
Claude Code 会根据评论内容修改代码，并提交新的 commit。你还可以让 Claude Code 帮助回复评论或补充说明，从而加速 PR 的流程。

#### 自动化流程：

通过结合 **Hooks** 和 **CI/CD**，你可以让 PR 的创建和检查更加自动化。例如，可以配置一个 Hook 在每次提交后自动运行测试和代码检查，并将结果附加到 PR 上。Claude Code 也可以集成到 CI 中，作为代码审查的一部分。这些高级用法将在后续章节介绍。

### 4.6 处理文档

文档是项目的重要组成部分，但编写和维护文档往往被忽视。Claude Code 可以帮助你自动生成和更新文档，确保文档与代码同步。

#### 生成 README：

如果你刚完成一个新功能或重构了某个模块，可以让 Claude Code 更新 README 文档：
```bash

> 更新 README，添加关于新功能的使用说明

```
Claude Code 会阅读代码中的注释和功能描述，然后生成相应的 README 内容。你还可以指定格式或语言，例如：
```bash

> 用 Markdown 格式更新 README，并包括代码示例

```
Claude Code 会按照你的指示编写文档。

#### 生成 API 文档：

对于 API 项目，你可以让 Claude Code 生成接口文档：
```bash

> 为这个 API 生成文档，包括每个端点的参数和返回值说明

```
Claude Code 会分析代码中的路由定义、参数校验和返回数据结构，自动生成清晰的 API 文档。

#### 代码注释和 JSDoc：

Claude Code 也可以帮助你在代码中添加注释或 JSDoc，以提高代码的可读性。例如：
```bash

> 为这个 JavaScript 模块添加 JSDoc 注释

```
Claude Code 会为函数、类等添加类型和功能说明注释。你还可以要求它生成**内联注释**来解释复杂逻辑：
```bash

> 在这个复杂的算法代码中添加注释，解释每一步的作用

```
通过这些方式，Claude Code 可以让你的项目文档更加完善和准确，减少手动编写文档的工作量。

## 5. 高级功能与技巧

Claude Code 提供了许多高级功能和配置选项，让你能够将其打造成一个完全符合个人和团队需求的编程助手。在本节中，我们将介绍一些进阶用法和技巧，帮助你充分发挥 Claude Code 的潜力。

### 5.1 斜杠命令与自定义命令

Claude Code 的交互式界面支持**斜杠命令（slash commands）**，这是一种通过命令前缀来快速执行特定任务的机制。斜杠命令在许多方面类似于你可能在其他应用中见到的命令（例如 Slack 的 /command 或 Discord 的 /命令），但 Claude Code 的斜杠命令更为强大，因为它们可以接受参数并与你的代码库深度集成。

#### 内置斜杠命令：

Claude Code 自带了许多内置的斜杠命令，用于常见的操作和配置。以下是一些常用的内置斜杠命令及其作用：

- `/help`：显示所有可用命令的列表和简要说明。
- `/clear`：清除当前的对话历史，相当于重新开始一次对话。
- `/exit`：退出 Claude Code 的交互式会话。
- `/plan`：打开Plan模式
- `/resume`：查看历史对话情况
- `/config`：打开 Claude Code 的设置界面，你可以在此修改各种配置选项。
- `/agents`：管理和查看自定义的子代理（Agents）列表，也可以创建新的子代理。
- `/permissions`：查看或修改当前的权限策略，例如添加允许不经确认直接执行的命令。
- `/bug`：报告一个 bug，它会将当前的对话内容发送给 Anthropic 支持团队。
- `/init`：初始化项目，它会为你生成一个 `CLAUDE.md` 文件，用于指导 Claude Code 理解你的项目。
- `/mcp`：管理 Model Context Protocol (MCP) 服务器的连接和认证。
- `/plugin`：管理 Claude Code 的插件，例如启用、禁用或安装插件。
- `/status`：显示当前会话的状态信息，包括模型版本、账户信息、网络连接状态等。
- `/stats`：显示你的使用统计信息，例如最近 7 天的会话数、模型调用次数等。

这些内置命令涵盖了从基础会话管理到高级配置的各个方面，你可以通过 `/help` 查看完整列表。

#### 自定义斜杠命令：

除了内置命令，Claude Code 还允许你创建**自定义斜杠命令**，以便将常用的提示或任务流程封装成命令。自定义命令实际上是存储在 Markdown 文件中的提示模板，当你在对话中调用该命令时，Claude Code 会读取文件内容并执行其中的提示。

自定义命令分为**项目命令**和**个人命令**两种作用域。

- **项目命令：**存储在项目的 `.claude/commands/` 目录下。项目命令会与代码仓库一起提交，供团队中的所有人使用。例如，你可以创建一个 `.claude/commands/deploy.md` 文件，其中包含部署流程的提示，这样团队中的每位成员都可以通过 `/deploy` 命令来运行部署流程。
- **个人命令：**存储在用户目录下的 `~/.claude/commands/` 目录中。个人命令仅对当前用户可用，适用于你个人常用的命令或脚本。例如，你可以创建一个 `~/.claude/commands/review-pr.md`，其中包含代码审查的提示，这样你可以在任何项目中使用 `/review-pr` 来审查代码。

自定义命令的**命名**与其文件名相关：命令名就是文件名去掉 `.md` 后缀。例如，`deploy.md` 对应的命令名就是 `/deploy`。如果项目命令和个人命令同名，则项目命令优先，个人命令会被忽略。

自定义命令的**参数**支持使用占位符来动态传入内容。主要有以下两种方式：

- **`$ARGUMENTS` 占位符：**捕获命令调用时传入的所有参数。例如，在命令文件中写有 `Fix issue #$ARGUMENTS`，当你在对话中输入 `/fix-issue 123 high-priority` 时，`$ARGUMENTS` 将被替换为 "123 high-priority"。
- **`$1`, `$2` 等位置参数：**允许你分别访问传入的第1个、第2个等参数。例如，命令文件中有 `Review PR #$1 with priority$2`，当你输入 `/review-pr 456 high` 时，`$1` 为 "456"，`$2` 为 "high"。位置参数适合需要单独处理每个参数的场景。

自定义命令的**语法**非常简单，你只需要在 Markdown 文件中撰写提示即可。Claude Code 会将文件内容作为提示发送给模型执行。例如，一个简单的自定义命令 `.claude/commands/optimize.md` 内容如下：
```markdown

分析这段代码的性能问题，并给出优化建议：

```
那么在对话中输入 `/optimize` 时，Claude Code 就会执行这个提示，分析当前代码并给出性能优化建议。

#### 命令示例：

下面我们通过几个示例来展示自定义斜杠命令的用途：

- **代码审查命令：**创建一个 `.claude/commands/review.md`，内容为：
```markdown

审查这段代码的安全性，并提出改进建议。

```
  这样你可以通过 `/review` 快速启动代码安全审查流程。

- **日志分析命令：**创建一个 `.claude/commands/analyze-log.md`，内容为：
```markdown

分析以下日志，并找出其中异常或错误：

```
  然后你可以将日志文件内容复制粘贴或通过管道传给 `/analyze-log` 命令，让 Claude Code 帮你分析日志。

- **部署命令：**创建一个 `.claude/commands/deploy.md`，内容为：
```markdown

按照以下步骤部署这个项目：

1. 运行构建命令
2. 运行测试
3. 如果测试通过，将代码部署到生产环境

```
  这样你可以通过 `/deploy` 来执行部署流程，Claude Code 会按照提示逐步执行构建、测试和部署等命令。

- **带参数的命令：**创建一个 `.claude/commands/fix-issue.md`，内容为：
```markdown

修复 issue #$ARGUMENTS 中描述的问题。

```
  然后你可以通过 `/fix-issue ENG-123` 来启动修复该 issue 的流程，Claude Code 会使用你的描述和 issue 详情来实施修复。

通过自定义斜杠命令，你可以将常用的开发任务自动化，提高工作效率。命令的创建和使用都十分灵活，你可以根据团队和个人的需求自由定制。

### 5.2 钩子 (Hooks)

**钩子（Hooks）**是 Claude Code 提供的一种强大的扩展机制，允许你在特定事件发生时自动执行自定义脚本或命令。钩子可以让你将 Claude Code 与你现有的开发工具链深度集成，实现高度自动化的工作流程。

Claude Code 支持多种类型的钩子，涵盖命令执行、文件变更、会话生命周期等各个方面。通过合理使用钩子，你可以让 Claude Code 在背后自动完成许多繁琐的任务，从而专注于代码本身。

#### 钩子类型：

Claude Code 提供了丰富的钩子事件，主要包括但不限于以下几类：

- **工具执行钩子：**在 Claude Code 调用某个工具（例如 Bash 命令、文件编辑、读取文件等）之前或之后触发。例如，你可以在 Bash 命令执行前记录一条日志，或在文件编辑后自动运行测试。
- **会话钩子：**在 Claude Code 会话的生命周期事件上触发，例如会话开始、会话结束、用户登录、用户登出等。这可以用于会话初始化配置或清理工作。
- **文件变更钩子：**当 Claude Code 修改了某个文件时触发。你可以利用这种钩子实现自动的代码格式化、Lint 检查等。
- **命令钩子：**当用户执行某个特定命令时触发。例如，你可以在用户运行 `/deploy` 命令时自动执行一些前置检查。
- **权限钩子：**当 Claude Code 需要请求用户许可时触发。你可以在此实现自定义的权限提示逻辑。

#### 配置钩子：

钩子通过配置文件来定义。Claude Code 提供了两种主要的钩子配置方式：

- **全局钩子：**在用户目录下的 `~/.claude/hooks.json` 文件中定义，这些钩子会应用于所有的项目。全局钩子适合用于个人通用的自动化需求。
- **项目钩子：**在项目根目录下的 `.claude/hooks.json` 文件中定义，这些钩子会与代码仓库一起提交，供团队共享。项目钩子适合用于团队共同使用的自动化流程。

钩子配置文件采用 JSON 格式。每个钩子由**事件名称**和**要执行的命令**组成。例如：
```json

{
		“PreToolUse”: {
		“Bash”: “echo ‘即将执行 Bash 命令’”
	},
		“PostToolUse”: {
		“Edit”: “npm run lint”
	},
		“OnSessionStart”: {
		“*”: “echo ‘会话开始，加载环境变量’ && source .env”
	},
		“OnSessionEnd”: {
		“*”: “echo ‘会话结束，清理缓存’ && rm -rf /tmp/claude_cache”
	}
}

```
上面的示例配置了以下钩子：

- 在执行 Bash 命令之前，打印一条消息（`PreToolUse.Bash`）。
- 在执行文件编辑操作之后，运行 `npm run lint` 来检查代码风格（`PostToolUse.Edit`）。
- 在任何会话开始时，加载环境变量文件 `.env`（`OnSessionStart.*`）。
- 在任何会话结束时，清理缓存目录（`OnSessionEnd.*`）。

#### 钩子示例：

下面我们通过几个具体场景来展示钩子的用途：

- **自动运行测试：**你可以在文件编辑后自动运行测试，以确保每次修改都没有破坏功能。配置如下：
```json

{
	“PostToolUse”: {
		“Edit”: “npm test”
	}
}

```
  这样，每当 Claude Code 修改了文件，都会立即运行 `npm test`，并报告测试结果。如果测试失败，Claude Code 会继续分析并尝试修复，从而形成闭环。

- **自动格式化代码：**你可以在文件编辑后自动格式化代码。例如，对于 Python 项目，可以配置：
```json

{
	“PostToolUse”: {
		“Edit”: “black .”
	}
}

```
  这样每次代码修改后，都会运行 `black .` 对项目进行格式化，确保代码风格一致。

- **日志钩子：**你可以记录 Claude Code 执行的命令，方便审计和调试。配置如下：
```json

{
	“PreToolUse”: {
		“Bash”: “echo "[(date)]执行Bash命令:(*d**a**t**e*)]执行*B**a**s**h*命令:COMMAND" >> claude.log”
	}
}

```
  这会在每次执行 Bash 命令前，将命令和时间戳追加写入 `claude.log` 文件。

- **会话初始化：**在会话开始时执行一些初始化脚本。例如：
```json

{
	“OnSessionStart”: {
		“*”: “echo ‘会话开始，初始化环境’ && pip install -r requirements.txt”
	}
}

```
  这样每次启动 Claude Code 时，都会自动安装依赖，确保环境就绪。

- **会话清理：**在会话结束时执行一些清理工作。例如：
```json

{
	“OnSessionEnd”: {
		“*”: “rm -rf /tmp/claude_session_cache”
	}
}

```
  这样每次退出 Claude Code 时，都会删除临时缓存文件，保持环境整洁。

#### 高级钩子技巧：

- **条件钩子：**你可以在钩子脚本中加入条件判断，实现更复杂的逻辑。例如，只有当修改的是特定文件时才运行某些命令。
- **链式钩子：**一个钩子可以触发另一个钩子。例如，在文件编辑后运行测试，测试失败后触发一个通知钩子，发送邮件或 Slack 消息。
- **插件钩子：**如果你安装了 Claude Code 插件，插件也可以提供钩子。插件钩子的配置方式与自定义钩子类似，通常在插件目录的 `hooks.json` 中定义【6†source】。

通过钩子，你可以让 Claude Code 成为一个高度自动化、高度定制的开发助手。它不仅能执行命令，还能在合适的时候介入你的工作流程，为你节省时间和精力。

### 5.3 插件与 MCP

Claude Code 的**插件系统**和**Model Context Protocol (MCP)** 集成极大地扩展了其能力，使其能够连接到外部工具和服务，执行更复杂的任务。

#### 插件系统：

Claude Code 的插件允许你为其添加**自定义命令**、**子代理**和**工作流**，从而满足特定需求【13†source】。插件本质上是一些包含配置和脚本的目录，可以由你或社区创建。安装插件后，Claude Code 会将其集成到交互界面中，就像内置功能一样使用。

- **发现和安装插件：**你可以从 GitHub 等社区获取别人分享的插件，也可以自行创建。官方提供了一个插件注册表，你可以通过 `/plugin` 命令来浏览和安装预置的插件【6†source】。安装插件通常只需要将插件目录放置到指定的插件目录（例如 `~/.claude/plugins/`）中，然后在 Claude Code 中启用即可。
- **插件功能：**一个插件可以提供以下几类功能【13†source】：
  - **自定义斜杠命令：**插件可以定义新的斜杠命令，扩展 Claude Code 的命令集。
  - **子代理：**插件可以创建专门的子代理，用于特定领域的任务。例如，安全插件可能提供一个"安全审查"子代理，专门用于代码安全审计。
  - **钩子脚本：**插件可以包含钩子脚本，在特定事件发生时执行插件逻辑。
  - **MCP 服务器：**插件可以捆绑 MCP 服务器，当插件启用时自动提供外部工具集成（详见下文 MCP 部分）。
- **插件管理：**通过 `/plugin` 命令，你可以列出所有已安装的插件、启用或禁用某个插件，以及查看插件的详细信息【6†source】。你还可以卸载不再需要的插件。

#### MCP (Model Context Protocol)：

MCP 是一种开源标准，用于将 AI 工具（如 Claude Code）与外部服务和数据源连接起来。Claude Code 既可以用作 MCP 客户端，也可以作为 MCP 服务器，这使得它能够与数百种工具和服务集成。

- **Claude Code 作为 MCP 客户端：**当 Claude Code 作为 MCP 客户端时，它可以连接到各种 MCP 服务器，使用这些服务器提供的工具。MCP 服务器可以封装任何外部服务，例如数据库、API、图形设计工具等。Claude Code 通过配置来添加这些服务器连接。
  - **添加 MCP 服务器：**你可以使用 `claude mcp add` 命令来添加一个 MCP 服务器连接。该命令的基本语法是：
```bash

claude mcp add [选项] <名称> – <命令> [参数…]

```
其中，`--` 用于分隔 Claude 的选项和服务器命令。`<名称>` 是你给这个服务器起的标识符，方便后续引用。
  - **传输类型：**MCP 支持多种传输方式，包括远程 HTTP、SSE（Server-Sent Events）和本地进程（stdio）。远程 HTTP 服务器是最常见的方式，适用于云服务；SSE 是一种已弃用的方式；本地 stdio 则适用于需要在本地运行的脚本或工具。
  - **环境变量：**有些 MCP 服务器可能需要环境变量或认证令牌。你可以使用 `--env KEY=VALUE` 选项来传递环境变量。例如：
```bash

claude mcp add --env API_KEY=xyz my-server – python /path/to/server.py

```
这将启动一个 Python MCP 服务器，并将 `API_KEY` 环境变量传递给它。
  - **管理 MCP 服务器：**你可以使用 `claude mcp list` 查看所有已配置的服务器，`claude mcp get <名称>` 查看某个服务器的详细信息，`claude mcp remove <名称>` 移除一个服务器。在交互式会话中，你也可以运行 `/mcp` 命令来检查 MCP 服务器的状态。
  - **使用 MCP 工具：**一旦连接了 MCP 服务器，Claude Code 就可以像使用内置工具一样使用这些服务器提供的工具。例如，你连接了一个 GitHub MCP 服务器，那么你就可以让 Claude Code "创建 GitHub issue"或"获取 PR 列表"，Claude Code 会通过 MCP 调用相应的 GitHub API。

- **Claude Code 作为 MCP 服务器：**Claude Code 本身也可以作为一个 MCP 服务器，供其他应用连接。这意味着你可以在其他工具（如 IDE、自定义脚本）中通过 MCP 协议使用 Claude Code 的能力。例如，一个 IDE 插件可以通过 MCP 与 Claude Code 通信，从而在编辑器中调用 Claude Code 的功能。

- **MCP 示例：**下面我们通过几个例子说明 MCP 的强大功能：
  - **连接 Jira：**添加一个 Jira MCP 服务器，然后在 Claude Code 中说："*为 Jira issue ENG-4521 创建一个 PR*"。Claude Code 会调用 MCP 从 Jira 获取 issue 详情，然后在你的代码库中实现相应的功能并创建 PR。
  - **监控数据集成：**连接 Sentry 和 Statsig 等 MCP 服务器，让 Claude Code 可以访问监控数据。你可以说："*查看 ENG-4521 功能的使用情况*"，Claude Code 会通过 MCP 获取 Sentry 错误和 Statsig 统计，并给出报告。
  - **数据库查询：**连接 PostgreSQL MCP 服务器，让 Claude Code 可以查询数据库。你可以说："*查找使用了 ENG-4521 功能的 10 位用户的邮箱*"，Claude Code 会通过 MCP 执行 SQL 查询并返回结果。
  - **设计和文档集成：**连接 Figma、Google Drive 等 MCP 服务器，让 Claude Code 可以访问设计稿和文档。你可以说："*根据 Slack 上的 Figma 设计更新邮件模板*"，Claude Code 会通过 MCP 获取 Figma 设计和 Drive 文档，然后更新代码。
  - **自动化工作流：**连接 Gmail、Slack 等服务，让 Claude Code 可以发送邮件或消息。你可以说："*为这 10 位用户创建反馈会议的 Gmail 草稿*"，Claude Code 会通过 MCP 调用 Gmail API 创建草稿。

#### MCP 配置范围：

MCP 服务器配置也支持作用域概念，可以在项目、用户或托管级别配置。例如，你可以在项目根目录添加一个 `.mcp.json` 文件，其中定义了项目需要的 MCP 服务器，这样团队的每个人都会自动拥有这些服务器连接。

#### 插件与 MCP 结合：

插件可以捆绑 MCP 服务器配置。当你启用一个插件时，如果插件提供了 MCP 服务器，Claude Code 会自动加载这些服务器。这样，插件的功能就不仅限于命令和钩子，还可以通过 MCP 与外部服务深度集成。

通过插件和 MCP，Claude Code 能够成为一个开放的平台，连接到你工作中的各种工具和服务。无论是企业内部系统、第三方 API，还是本地脚本，都可以通过插件或 MCP 集成到 Claude Code 中，让 AI 助手真正融入你的开发环境。

### 5.4 使用 Plan 模式

**Plan 模式**是 Claude Code 提供的一种特殊权限模式，它将 Claude Code 限制为只读操作，不会修改任何文件。这种模式非常适合用于代码审查、方案规划或在需要谨慎操作的场景下深入了解代码库。

Plan 模式的主要用途包括：

- **多步骤实现规划：**当你需要实现一个涉及多个文件和步骤的功能时，先使用 Plan 模式规划整体方案，可以避免遗漏和混乱。例如，你可以在 Plan 模式下让 Claude Code "规划将认证系统迁移到 OAuth2 的步骤"，得到一个详细的计划后再执行。
- **代码探索：**当你希望深入分析代码库的某一部分，但暂时不想做任何修改时，Plan 模式能让你安全地提问和浏览。例如，你可以在 Plan 模式下让 Claude Code "解释这个模块的工作原理"，它会阅读代码并给出解释，但不会修改任何东西。
- **交互式开发：**当你希望与 Claude Code 共同讨论实现方案，逐步明确需求时，Plan 模式可以避免过早地修改代码，让讨论更加专注。你可以提出多个方案，让 Claude Code 在 Plan 模式下分析各自的优劣，然后再决定采用哪种方案实施。

Plan 模式的使用非常灵活。你可以在交互式会话中通过快捷键切换模式：默认是 Normal 模式，按一次 `Shift+Tab` 进入 Auto-Accept 模式，再按一次 `Shift+Tab` 就进入 Plan 模式。你也可以直接在启动会话时指定 Plan 模式：
```bash

claude --permission-mode plan

```
或者在命令中直接以 Plan 模式执行一次性查询：
```bash

claude -p --permission-mode plan “分析认证系统并提出改进建议”

```
这样会以 Plan 模式运行该查询，然后退出，不会修改任何文件。

在 Plan 模式下，Claude Code 会采用 `AskUserQuestion` 工具来与你交互，以便在规划过程中收集更多的信息。这意味着它可能会向你提出一些多选问题来明确需求，从而给出更完善的方案。例如，在规划认证迁移时，它可能问你："是否需要保持向后兼容？"、"是否需要通知用户？"等。你可以根据这些提示做出选择，然后 Claude Code 会据此完善计划。

Plan 模式还可以通过配置设为默认模式，例如在 `settings.json` 中设置 `"defaultMode": "plan"`。

```json

{
    “permissions”: {
        “defaultMode”: “plan”
    }
}

```

这样新会话都会以 Plan 模式开始。这对于需要频繁进行代码审查和方案规划的开发者来说非常实用。

### 5.5 让 Claude 面试你

Claude Code 提供了一种独特的交互方式：**让 Claude 主动提问，你来回答**。这种方式被称为"让 Claude 面试你"或"需求收集"模式。在某些情况下，这种反向的交互比直接让 Claude 开始编码更有效，尤其是在需求尚未明确的时候。

你可以通过在对话中明确指示来启动这种模式。例如：
```bash

> 在开始编码之前，请先向我提问，以明确这个功能的需求：用户通知系统

```
Claude Code 会进入"面试"模式，向你提出一系列问题来澄清功能需求。这些问题可能是多选题或开放式问题，旨在收集实现功能所需的各种信息。例如：
```bash

> 这个通知系统需要支持哪些通知渠道（例如邮件、短信、站内消息）？
> 用户是否可以订阅不同类型的通知？
> 通知的内容是固定的还是可以自定义？

```
通过这些问题，Claude Code 能够更全面地了解你的需求。你可以一一回答，或者在某些选项上给出自己的倾向。Claude Code 会根据你的回答调整后续的问题，确保不遗漏任何重要细节。

当 Claude Code 收集到足够的信息后，它会总结出一个需求规格说明书，并据此开始编码。由于在编码前已经明确了大部分细节，因此生成的代码往往更符合预期，减少了返工的可能。

这种"面试"模式在 Plan 模式下尤为常见，因为 Plan 模式鼓励 Claude Code 在执行前先明确需求。不过，你也可以通过在项目的 `CLAUDE.md` 文件中添加指导来鼓励 Claude Code 在其他模式下也主动提问。例如，在 `CLAUDE.md` 中写明：
```markdown

始终在有多种可行方案时主动提出澄清问题。

```
这样，当 Claude Code 面对一个有多种实现方式的需求时，它会按照你的指导来提问，让你选择最合适的方案。

让 Claude 面试你的方式适用于复杂功能、大型项目的开发，以及团队协作中需求讨论等场景。它能够帮助开发者在动手编码前理清思路，提高开发效率和代码质量。

### 5.6 并行会话与 Git Worktree

Claude Code 支持同时运行多个会话，并且可以结合 Git Worktree 实现并行开发。这对于需要同时处理多个任务或分支的开发者来说非常有用。

#### 并行会话：

你可以在不同的终端窗口中分别启动 Claude Code，同时进行多个对话。例如，一个会话用于编写新功能，另一个会话用于调试旧功能。Claude Code 的每个会话都是独立的，拥有自己的上下文和状态。这意味着你可以在一个会话中专注于某个问题，而另一个会话中让 Claude Code 执行长时间的构建或测试，互不干扰。

#### Git Worktree 集成：

Git Worktree 允许你在同一个仓库中同时检出多个分支，每个分支都在不同的目录中工作。Claude Code 可以很好地与 Git Worktree 结合使用。例如：
```bash

git worktree add …/feature-a feature-a
git worktree add …/bugfix-b bugfix-b

```
这样你就有了 `../feature-a` 和 `../bugfix-b` 两个工作目录，分别对应 `feature-a` 和 `bugfix-b` 分支。你可以在 `feature-a` 目录下启动一个 Claude Code 会话开发新功能，同时在 `bugfix-b` 目录下启动另一个会话修复 bug。两个会话各自读取各自目录的代码，不会互相干扰。

#### 并行会话的用途：

- **多任务处理：**你可以同时处理多个功能或 bug，而无需频繁切换上下文。每个任务都有自己独立的 Claude Code 会话和目录。
- **长时间运行的任务：**在一个会话中让 Claude Code 执行耗时的操作（例如构建大型项目、运行完整测试套件），同时在另一个会话中进行其他工作。
- **多分支开发：**在开发一个功能时，你可以让 Claude Code 在主分支上运行测试，在功能分支上进行编码，两者并行推进。

#### 注意事项：

虽然 Claude Code 支持并行会话，但需要注意以下几点：

- 确保每个会话运行在不同的工作目录下，以避免上下文混淆。
- 如果多个会话访问同一个文件或资源，可能需要协调它们的操作，以避免冲突。
- 并行会话会消耗更多的资源（如内存和 API 调用），请根据你的订阅和系统资源合理使用。

通过并行会话和 Git Worktree，你可以充分利用 Claude Code 的多任务处理能力，大幅提高开发效率。

### 5.7 作为 Unix 工具使用

Claude Code 的设计遵循 Unix 哲学，这使得它能够像其他命令行工具一样组合使用。你可以通过管道（`|`）将其他命令的输出传递给 Claude Code，也可以通过重定向将 Claude Code 的输出保存到文件。

#### 管道输入：

你可以将一个命令的输出直接作为 Claude Code 的输入。例如：
```bash

cat app.log | claude -p “如果在日志中看到任何异常，请通知我”

```
这个命令会将 `app.log` 文件的内容通过管道传递给 Claude Code，并要求它如果在日志中发现异常就通知你。Claude Code 会读取输入内容，并执行相应的提示。由于使用了 `-p` 选项，Claude Code 在处理完输入后会直接退出，不会进入交互模式。

#### 重定向输出：

你还可以将 Claude Code 的输出重定向到文件。例如：
```bash

claude -p “解释一下这个函数的作用” > explanation.txt

```
这个命令会将 Claude Code 对函数解释的输出保存到 `explanation.txt` 文件中，而不是打印在终端上。

#### 结合其他工具：

Claude Code 可以与你的其他开发工具无缝结合。例如：

- **日志分析：**将应用日志通过管道传给 Claude Code，让它在日志中发现问题时通知你。
- **代码生成：**将一个设计文档通过管道传给 Claude Code，让它根据文档生成代码框架。
- **测试报告：**将测试输出传给 Claude Code，让它分析失败原因并给出修复建议。
- **翻译任务：**将一段文本传给 Claude Code，让它翻译成另一种语言。例如：
```bash

echo “Hello, World!” | claude -p “将这段文本翻译成法语”

```
#### 作为 CI 任务：

Claude Code 也可以集成到 CI/CD 流程中。例如，你可以在 CI 脚本中运行：
```bash

claude -p “如果发现新的文本字符串，将其翻译成法语并创建一个 PR”

```
这个命令会在每次提交时运行，如果发现新的字符串需要翻译，就让 Claude Code 自动翻译并创建 PR。这样，你就可以实现高度自动化的开发流程。

通过将 Claude Code 作为 Unix 工具使用，你可以将其融入几乎任何工作流程，发挥出强大的组合效应。

### 5.8 控制输出格式

默认情况下，Claude Code 会以易读的自然语言格式输出结果。但在某些场景下，你可能需要更结构化或特定格式的输出。Claude Code 提供了多种方式来控制输出格式，以满足不同的需求。

#### Markdown 格式：

Claude Code 支持以 Markdown 格式输出代码片段、文档等。当它生成代码或文档时，会使用适当的 Markdown 语法，例如代码块、标题、列表等，方便你在支持 Markdown 的编辑器或平台中直接使用。

#### 纯文本 vs Markdown：

你可以通过命令选项或斜杠命令来切换输出风格。例如，使用 `/output-style` 命令可以选择输出风格。选择"plain"会让 Claude Code 输出纯文本，不包含任何 Markdown 格式；选择"markdown"则会使用 Markdown 格式。你也可以通过在配置中设置 `"outputStyle": "markdown"` 来全局指定输出风格。

#### 代码块格式化：

当 Claude Code 生成代码时，它会自动将代码包裹在 Markdown 代码块中，并根据语言类型添加适当的语言标签，例如 ` python`或` javascript`，以便在支持语法高亮的编辑器中正确显示。如果你发现某些代码块缺少语言标签，导致渲染不正确，可以尝试使用 `/compact` 命令来精简对话历史，或者检查代码片段是否太长导致被截断。

#### JSON 输出：

对于脚本或自动化工具，你可能需要 Claude Code 以 JSON 格式输出，以便程序解析。Claude Code 提供了 `--output-format json` 选项来实现这一点。例如：

```bash

claude -p "列出所有文件的行数" --output-format json

```

这将输出一个 JSON 对象，其中包含文件列表和对应的行数。JSON 输出非常适合与 CI/CD 工具集成，你可以将其重定向到文件，然后由其他脚本解析处理。

#### 自定义提示词：

你还可以通过提示词来控制输出的格式和风格。例如，你可以要求 Claude Code “以表格形式列出所有接口”，那么它就会尝试使用 Markdown 表格格式输出。你也可以要求它"使用简洁的要点列出步骤"，那么它就会使用无序列表来呈现步骤。

通过合理地控制输出格式，你可以让 Claude Code 的输出更好地适应你的下游工具和需求，实现更高效的工作流程。

### 5.9 Claude Skills使用

参考文档 [Claude skills.md](../Claude Skills/Claude skills.md)

## 6. 最佳实践

要充分发挥 Claude Code 的潜力，掌握一些最佳实践是非常重要的。在本节中，我们将总结一些在使用 Claude Code 过程中被证明行之有效的技巧和策略，帮助你更高效地编码，更安全地使用 AI 辅助。

### 6.1 优化设置（CLAUDE.md 文件）

**CLAUDE.md** 是一个特殊的 Markdown 文件，当 Claude Code 启动时会自动将其内容加载到上下文中。利用 `CLAUDE.md` 文件，你可以为 Claude Code 提供项目的背景信息和指导原则，使其更好地理解你的代码库和工作流程。

#### 放置位置：

你可以将 `CLAUDE.md` 文件放置在多个位置：

- **项目根目录：**最常见的方式，放在你运行 `claude` 命令的目录下。你可以将其命名为 `CLAUDE.md` 并提交到仓库，与团队共享；或者命名为 `CLAUDE.local.md` 并加入 `.gitignore`，仅供个人使用。
- **父目录：**也可以放在你运行 `claude` 的目录的任何父目录中。这在 monorepo 结构中很有用，例如在仓库根目录和子目录分别放置 `CLAUDE.md`，Claude Code 会同时读取它们。
- **子目录：**放在运行 `claude` 目录的子目录中。当你进入某个子目录工作时，Claude Code 会按需读取该子目录的 `CLAUDE.md`，获取更具体的指导。
- **用户主目录：**放在 `~/.claude/CLAUDE.md`，这会将该指导应用到所有的 Claude Code 会话。

#### 内容建议：

在 `CLAUDE.md` 文件中，你可以包含以下内容：

- **常用命令：**列出项目中常用的构建、测试、部署命令及其用途。例如：
  `- `npm run build`: 构建项目   `- `npm run test`: 运行测试`
- **代码风格：**说明项目的编码规范和风格指南。例如：
  `- 使用 ES 模块语法，不要使用 CommonJS   `- 尽量解构导入`
- **工作流程：**描述团队的工作流程和约定。例如：
  `- 在完成一系列代码修改后，记得运行类型检查   `- 优先运行单个测试，而非整个套件，以提高性能`
- **环境设置：**说明项目所需的开发环境配置。例如：
  `- 使用 pyenv 切换 Python 版本   `- 需要 Node.js 版本 16 以上`
- **其他信息：**任何你认为 Claude Code 需要知道的信息，例如特殊的行为、已知的警告、项目结构解释等。

#### 动态改进：

`CLAUDE.md` 文件就像一份不断演进的提示词，你应该根据实际使用情况不断改进它。一个常见的错误是添加了大量内容但从未验证其效果。你应该花时间实验，观察哪些信息对 Claude Code 帮助最大，并据此精简或强化提示。你可以通过在对话中按 `#` 键快速将当前对话内容加入到 `CLAUDE.md` 中，方便你随时记录有用的命令或指导。许多工程师会频繁使用 `#` 键在编码过程中记录命令、文件和风格指导，然后将这些更改提交到仓库，让团队成员也受益。

#### 最佳实践：

- **保持简洁：**尽量将 `CLAUDE.md` 写得简洁明了，突出重点。冗长的提示可能占用过多 token 并降低效率。
- **结构清晰：**使用标题、列表等 Markdown 格式使 `CLAUDE.md` 易读易维护。
- **团队共享：**将通用的项目信息放在提交到仓库的 `CLAUDE.md` 中，将个人偏好放在本地的 `CLAUDE.local.md` 中，以平衡团队协作和个人定制。
- **版本控制：**将 `CLAUDE.md` 纳入版本控制，这样团队成员可以共享和改进它。同时，也可以通过 `.gitignore` 排除 `CLAUDE.local.md` 来保护个人信息。

通过精心维护 `CLAUDE.md` 文件，你可以让 Claude Code 更好地融入你的项目，提高代码生成的质量和准确性。

### 6.2 明确具体地提出请求

与 Claude Code 交互时，清晰而具体地提出请求能够显著提高其输出质量。模糊的请求往往导致 Claude Code 给出不相关或不完整的答案，而具体的请求则能引导它准确地完成你的意图。

#### 示例对比：

- 不好的请求：`"修复这个 bug"`。这个请求过于笼统，Claude Code 可能不知道从何入手，或者误解你的意思。
- 好的请求：`"修复登录 bug：用户输入错误凭证后看到空白屏幕"`。这个请求提供了上下文和具体现象，Claude Code 可以据此定位问题并实施修复。

#### 提供上下文：

在请求中包含相关的上下文信息。例如，不要只说"优化这个函数"，而应该说"优化这个函数以提高性能，它目前处理大数据时很慢"。上下文可以是错误信息、预期行为、相关文件名等。Claude Code 会根据这些信息更精准地完成任务。

#### 使用步骤式指令：

对于复杂任务，将其分解为若干步骤，并逐步引导 Claude Code 完成。例如：

```

> 1. 创建一个新的数据库表来存储用户资料
> 2. 创建一个 API 端点来获取和更新用户资料
> 3. 创建一个网页界面让用户查看和编辑自己的资料

```

这种分步的方式可以避免 Claude Code 一次性处理过多信息而遗漏细节，也方便你在每一步进行检查和调整。

#### 避免歧义：

尽量使用明确的语言，避免含糊或容易产生歧义的表述。例如，不要说"让它快一点"，而要说"将响应时间从 200ms 降低到 50ms 以下"。明确的指令能够减少来回确认的次数，提高效率。

#### 使用示例：

如果需要，可以提供示例来说明你的期望。例如，你可以说"请按照以下格式生成 JSON：`{...}`“，或者"这是一个期望输出的示例，请参照它编写代码”。

总之，具体明确的请求是获得高质量输出的关键。花一点时间把需求说清楚，往往可以节省更多的时间。

### 6.3 分步指导复杂任务

正如上一节提到的，对于复杂的任务，将其分解为多个小步骤并逐步指导 Claude Code 完成是一种有效策略。这种方法不仅适用于编码，也适用于调试、重构、文档编写等各种场景。

#### 逐步验证：

每完成一步，就让 Claude Code 运行相应的测试或检查，确保这一步没有引入问题。然后再进入下一步。例如，在重构一个模块时，你可以先让 Claude Code 重构函数 A，并运行相关测试；确认通过后，再重构函数 B，再次运行测试。这种逐步验证的方式可以及早发现问题，避免在最后阶段才发现大量错误。

#### 反馈循环：

在每一步完成后，你可以查看 Claude Code 的输出，并提供反馈。如果这一步的结果不符合预期，你可以指出哪里不合适，让 Claude Code 修正。然后再进入下一步。通过这种反复的反馈循环，你可以确保最终结果符合你的要求。

#### 并行工作：

对于某些任务，你也可以让 Claude Code 同时处理多个步骤，并在最后汇总。例如，你可以说：“先分析这三个模块，然后给出整体优化方案”。Claude Code 会先分别分析每个模块，再给出综合方案。这种方式在一定程度上可以并行工作，提高效率。

#### 使用斜杠命令：

如果你发现某类复杂任务经常需要分步完成，可以考虑将其封装成一个自定义斜杠命令。在命令中，你可以预先定义好步骤流程，这样以后再执行类似任务时，只需一个命令即可完成整个流程。

分步指导复杂任务的核心思想是"化整为零，逐步逼近"。通过这种方式，你可以充分利用 Claude Code 的能力，同时保持对过程的掌控，降低出错的风险。

### 6.4 先让 Claude 探索

在让 Claude Code 开始编码之前，先让它对代码库进行探索和理解，是一种值得推荐的做法。这尤其适用于你不熟悉的项目或需要大面积修改的情况。

#### 提出探索性问题：

让 Claude Code 先回答一些关于代码库的问题，以便它（和你）建立起对项目的整体认识。例如：

```

> 分析数据库模式，找出所有与用户相关的表
> 概述项目的认证流程
> 找出所有调用了外部 API 的地方

```

通过这些问题，Claude Code 会阅读和分析代码，并给出总结。这不仅有助于你了解项目，也让 Claude Code 熟悉了代码结构，为后续的编码做好准备。

#### 使用 Plan 模式：

正如前面提到的，Plan 模式非常适合用于代码探索。你可以在 Plan 模式下让 Claude Code 分析代码库或设计方案，而不会修改任何文件。这样你可以放心地让它深入分析，不必担心意外改动。

#### 建立心智模型：

通过让 Claude Code 先探索，它可以建立一个项目的"心智模型"，知道有哪些关键模块、它们之间的关系、常见的代码模式等。当它开始执行具体任务时，就能利用这个模型做出更合理的决策。

#### 避免遗漏：

先探索还能帮助发现一些潜在的依赖或需要修改的地方，避免在实际编码时遗漏。例如，你可能原本只打算修改一个函数，但通过探索发现这个函数被多个地方调用，可能需要同步修改调用者。

总的来说，"先让 Claude 探索"可以看作是一种"先调研，后动手"的开发习惯。它能提高代码修改的质量和完整性，减少返工。

### 6.5 使用快捷键

Claude Code 提供了一些快捷键，可以让你在交互时更加高效地操作。充分利用这些快捷键，可以节省时间并改善用户体验。

#### 常用快捷键：

根据文档，你可以按 `?` 键在交互时查看所有可用的快捷键列表。这里列出一些常用的快捷键及其功能：

- `Tab`：命令自动补全。当你输入命令或参数的一部分时，按 `Tab` 可以自动补全剩余部分。这对于减少输入错误和提高速度非常有用。
- `↑` / `↓`：浏览命令历史。按上箭头可以滚动查看你之前输入过的命令，方便重复执行或修改后执行。
- `Shift+Tab`：切换权限模式。在交互时按 `Shift+Tab` 会在 Normal、Auto-Accept、Plan 模式之间循环切换。这是快速进入 Plan 模式或退出 Plan 模式的便捷方式。
- `Ctrl+C`：中断当前命令。如果 Claude Code 正在执行某个长时间运行的命令或响应，你可以按 `Ctrl+C` 来中断它，返回到提示符。
- `Ctrl+D`：退出 Claude Code。在提示符下按 `Ctrl+D` 会结束会话，相当于输入 `/exit`。
- `#`：将当前对话添加到 `CLAUDE.md`。如果你在对话中获得了有用的信息或命令，可以按 `#` 将其加入到 `CLAUDE.md` 文件中，供以后使用。

#### 自定义快捷键：

目前 Claude Code 不支持自定义快捷键。不过，你可以通过终端的设置来调整一些行为。例如，在 VS Code 的集成终端中，你可以配置 Shift+Enter 为插入新行，以避免与 Claude Code 的快捷键冲突。另外，你也可以考虑使用终端复用工具（如 tmux、screen）来定义自己的快捷键，从而间接扩展 Claude Code 的快捷功能。

掌握并习惯使用这些快捷键，可以大大提高你在 Claude Code 中的操作效率，让工作流程更加流畅。

### 6.6 利用 Plan 模式减少风险

**Plan 模式**是一个非常有用的工具，可以帮助你在执行高风险或大规模的代码变更前进行周密的计划和审查。通过在 Plan 模式下预先规划，你可以显著降低出错的可能性，并提高代码变更的成功率。

#### 降低风险：

Plan 模式确保 Claude Code 不会对文件做任何修改，因此你可以放心地让它尝试各种方案，而不必担心破坏代码。这对于涉及多个文件或复杂逻辑的修改尤为重要，因为一旦在 Normal 模式下开始修改，可能已经产生了难以回滚的变更。

#### 全面审查：

在 Plan 模式下，Claude Code 会提供详细的计划和推理过程。你可以仔细审查每一步计划，确保没有遗漏或错误。如果发现问题，可以及时与 Claude Code 讨论并调整计划。这种审查过程在实际修改代码之前就完成了，从而避免了在实施过程中才发现需要返工。

#### 明确需求：

Plan 模式鼓励 Claude Code 提出澄清问题，这有助于你在编码前明确需求。许多 bug 和返工都源于需求不清晰，通过在 Plan 模式下让 Claude Code "面试"你，可以尽可能地在早期消除模糊之处。

#### 版本控制友好：

由于 Plan 模式不产生提交，你可以放心地进行多次尝试和讨论，而不会在版本历史中留下大量无意义的提交。当你最终确定方案并切换到 Normal 模式执行时，产生的提交才是清晰且有意义的。

#### 团队协作：

在团队环境中，Plan 模式也可以用于代码审查。你可以在 Plan 模式下让 Claude Code 生成一个变更方案，然后与团队成员一起审查这个方案，确认无误后再实施。这相当于在实施前进行了一次设计评审。

#### 示例：

假设你计划重构一个复杂模块，在 Plan 模式下，你可以让 Claude Code “给出将模块 X 重构为模式 Y 的详细计划”。它会列出需要修改的文件、每一步的具体操作以及可能的风险点。你可以和同事一起评审这个计划，确认没有问题后，再让 Claude Code 执行。这样，重构过程就会更加顺利，风险更低。

总之，Plan 模式是安全地探索和规划的利器。在涉及不确定因素或高风险的修改时，善用 Plan 模式可以让你更有信心地推进工作。

### 6.7 为敏感数据使用 MCP

在处理敏感数据（例如数据库、私有 API）时，使用 MCP（Model Context Protocol）服务器是比直接命令行工具更安全的选择。MCP 允许你封装对敏感数据的访问，并通过细粒度的权限控制来确保只有经过授权的操作才能执行。

#### 封装敏感操作：

通过 MCP，你可以将访问敏感数据库或服务的逻辑封装在一个专门的服务器中。Claude Code 只能调用 MCP 服务器提供的工具，而不能直接执行任意的 SQL 或 API 请求。这意味着你可以限制 Claude Code 只能执行查询，不能修改数据；或者只能查询特定的表，不能访问整个数据库。

#### 细粒度权限控制：

MCP 服务器可以实现复杂的权限策略。例如，你可以配置 MCP 只允许 Claude Code 读取最近一个月的日志，或者只允许它在测试环境中修改数据，而在生产环境中只能查询。这种细粒度的控制通过命令行工具很难实现，因为命令行工具通常给予 Claude Code 与你相同的权限。

#### 审计和日志：

由于所有对敏感数据的访问都经过 MCP 服务器，你可以在服务器端记录详细的日志和审计信息。例如，记录每次查询的内容、调用者、时间等。这有助于追踪和合规检查。

#### 降低提示注入风险：

直接让 Claude Code 执行命令行工具可能存在提示注入风险（即恶意提示诱导 Claude Code 执行你未授权的操作）。使用 MCP 可以降低这种风险，因为 MCP 服务器可以验证和过滤 Claude Code 发来的请求，确保其符合预定义的安全策略。

#### 企业环境：

在企业环境中，IT 部门可以提供托管 MCP 服务器，供所有开发者使用。这样，开发者无需直接访问敏感数据，就能通过 Claude Code 完成任务，同时 IT 也能集中管理和审计这些操作。

#### 示例：

假设你有一个包含敏感用户信息的 PostgreSQL 数据库。与其让 Claude Code 直接执行 SQL（这需要将数据库密码暴露给 Claude Code），不如编写一个 MCP 服务器，提供"查询用户邮箱"和"更新用户状态"两个工具，并在服务器中实现权限校验和日志记录。然后，你只需要在 Claude Code 中连接这个 MCP 服务器，就可以让它安全地查询或更新数据，而无需担心越权操作。

总之，为敏感数据使用 MCP 是一种最佳实践。它在提供强大功能的同时，最大限度地保护了你的数据安全和合规性。

### 6.8 使用 CLI 工具而非 MCP

与上一条相反，对于**非敏感**数据或一般性的任务，直接使用命令行工具往往比通过 MCP 更简单直接。MCP 虽然强大，但搭建和维护 MCP 服务器需要额外的工作。如果你的任务不涉及敏感数据，或者你只是偶尔需要调用某个工具，那么直接让 Claude Code 使用 CLI 可能是更高效的选择。

#### 减少复杂性：

使用 CLI 意味着你无需编写额外的 MCP 服务器代码，也无需管理 MCP 服务器的运行。Claude Code 可以直接调用你系统中的任何命令，这对于日常开发来说非常方便。

#### 性能：

直接调用 CLI 通常比通过 MCP 调用要快，因为少了中间服务器这一层。对于频繁执行的小任务，这种性能差异可能累积起来变得显著。

#### 灵活性：

命令行工具种类繁多，几乎涵盖了开发工作的方方面面。直接使用 CLI 意味着你可以利用所有这些现有工具，而不需要为每个工具都去封装一个 MCP 服务器。

#### 示例：

假设你需要 Claude Code 帮你运行测试。你完全可以直接让它执行 `npm test` 或 `pytest`，而不必为此专门编写一个 MCP 服务器来封装测试命令。同样，如果你需要它调用某个简单的脚本或工具，直接通过 Bash 让它执行即可。

#### 安全考量：

当然，在使用 CLI 工具时，你仍然需要注意安全。例如，不要让 Claude Code 以 root 用户身份执行命令，避免将敏感的 API 密钥直接暴露在命令行中等。但对于大多数日常任务，这些基本的安全措施已经足够。

总的来说，**何时使用 MCP，何时直接使用 CLI**，取决于任务的性质和你的需求。简单、非敏感的任务可以直接用 CLI；复杂、敏感或需要细粒度控制的任务则应考虑 MCP。在实际工作中，你可能会两者结合使用，以兼顾效率和安全性。

### 6.9 团队协作标准化

在团队环境中使用 Claude Code，制定一些标准和最佳实践是非常有益的。这可以确保团队成员之间的协作顺畅，避免因为个人使用习惯不同而造成冲突或效率低下。

#### 共享配置：

将团队通用的配置放入项目的 `.claude` 目录中，并通过版本控制共享。这包括 `settings.json`、`CLAUDE.md`、自定义斜杠命令、钩子脚本等。这样，每个人 clone 仓库后都能使用相同的配置，确保行为一致。

#### 规范权限策略：

在团队的配置中明确允许和禁止的操作。例如，团队可能决定所有成员都禁止不经确认直接删除文件，或者允许大家在开发环境不经确认运行测试，但在生产环境必须确认。这些策略应该在共享的 `settings.json` 中定义，避免个人配置与团队约定冲突。

#### 标准化工作流：

制定一些常见任务的团队工作流程。例如，约定大家都使用相同的斜杠命令来执行部署、代码审查等。可以通过共享的自定义命令来强制这些流程。这样，无论谁执行任务，步骤都是一致的。

#### 培训和文档：

为团队成员提供 Claude Code 的使用培训，并编写团队使用指南。这可以包括推荐的配置、常用命令示例、遇到问题时的联系渠道等。一个知识库或 wiki 也是很好的资源，团队成员可以在上面分享自己的技巧和遇到的问题及解决方案。

#### 代码审查：

在代码审查中，除了审查功能实现，也可以审查是否使用了 Claude Code 辅助，以及是否遵循了团队的使用规范。例如，检查是否有人在不应该使用 MCP 的地方使用了 MCP，或者是否有敏感操作没有经过适当的权限控制。

#### 反馈循环：

定期收集团队成员对 Claude Code 使用的反馈，讨论哪些做法有效，哪些需要改进。随着团队和项目的演进，可能需要调整配置和策略。保持一个开放的讨论渠道，有助于持续优化团队的使用方式。

通过在团队层面标准化 Claude Code 的使用，你可以避免"每个人各自为政"的情况，确保团队作为一个整体高效、安全地利用 AI 辅助开发。

### 6.10 持续学习和实验

最后，但同样重要的一点是：保持学习和实验的心态。Claude Code 是一个不断发展的工具，新的功能和改进会不断推出。同时，它也是一种相对新颖的编程范式，每个人都有可能发现更好的使用方法。

#### 关注官方更新：

定期查看 Claude Code 的官方文档和更新日志，了解新功能和变化。这些新功能可能正是你工作中需要的，能够显著提升你的效率。

#### 分享和交流：

加入社区，分享你的使用心得和遇到的问题。例如，可以加入 Claude 开发者 Discord 社区，与其他用户交流技巧。你也可以在团队内部分享你的发现，或者在公司内部组织技术分享会。

#### 实验新用法：

不要局限于已知的使用方式。尝试一些新的组合，看看能否更高效地完成任务。例如，你可以尝试将 Claude Code 与你之前从未结合过的工具集成，看看会带来什么效果。实验可能会失败，但成功的那一次可能就带来巨大的收益。

#### 从错误中学习：

如果在使用 Claude Code 的过程中犯了错（例如，因为提示不当导致生成了错误的代码），不要气馁。把它当作一次学习机会，思考如何改进提示或配置，避免下次再犯。记录下这些经验教训，久而久之你会形成自己的一套"最佳实践"。

#### 适应变化：

随着你或团队的成长，工作需求可能会变化。相应地，Claude Code 的使用方式也需要调整。保持灵活性，根据实际情况调整配置和工作流程。例如，项目初期可能更注重快速开发，允许更宽松的权限；到了稳定期，可能需要收紧权限，加强审查。根据阶段不同，采用不同的策略。

总之，把使用 Claude Code 当作一个持续优化的过程。没有一成不变的"最好用法"，只有最适合当下环境和团队的用法。通过不断学习和实验，你和团队都能从中受益，让 Claude Code 成为你们越来越强大的编程助手。

## 7. 故障排除

在使用 Claude Code 的过程中，你可能会遇到一些常见的问题。本节将针对一些常见错误和异常情况提供排查思路和解决方案，帮助你快速恢复工作。

### 7.1 安装相关问题

#### 问题：

在 Windows 的 WSL 环境下安装时遇到错误，或安装后找不到 `claude` 命令。

#### 原因：

这可能是由于 WSL 环境配置不当或环境变量未设置导致的。例如，WSL 可能使用了 Windows 的 npm 路径，或者 `claude` 可执行文件没有被添加到 PATH。

#### 解决：

确保在 WSL 中使用 Linux 版本的 Node.js 和 npm。可以通过 `which node` 和 `which npm` 检查，如果它们指向 Windows 路径（以 `/mnt/c/` 开头），说明 WSL 正在使用 Windows 的 Node。解决方法是安装 Linux 版本的 Node.js 或使用 nvm 切换到 Linux 环境。另外，确保 `~/.local/bin` 在你的 PATH 中。如果使用原生安装脚本，它应该已经创建了到 `~/.local/bin/claude` 的符号链接。你可以通过 `export PATH="$HOME/.local/bin:$PATH"` 将其加入 PATH（将此命令添加到 `~/.bashrc` 或 `~/.zshrc` 以永久生效）。对于 Windows 原生安装，如果提示找不到命令，请检查是否将 `%USERPROFILE%\.local\bin` 添加到了系统 PATH。如果问题依旧，可以尝试使用管理员权限重新安装，或查看安装日志定位问题。

#### 问题：

安装时提示找不到命令或权限被拒绝。

#### 原因：

在 Linux/macOS 上，如果使用 npm 安装，可能需要 `sudo` 权限或配置 npm 使用用户目录。另外，如果系统的全局安装前缀路径不可写，也会导致权限错误。

#### 解决：

建议使用官方提供的原生安装脚本，而非通过 npm 安装。原生安装脚本不需要 sudo，也不会遇到 npm 相关的路径问题。如果已经通过 npm 安装失败，可以尝试删除 `node_modules` 并重新安装，或使用 `npm config set prefix` 设置一个可写的前缀路径。在任何情况下，如果遇到权限错误，请确保当前用户有权限写入目标目录。对于 Linux/macOS，可以尝试使用 `sudo npm install -g @anthropic-ai/claude-code`，但要注意这会将文件安装到系统目录，可能需要后续用 sudo 卸载或更新。

#### 问题：

安装成功，但运行 `claude` 时提示"command not found"。

#### 原因：

这通常是因为 `claude` 可执行文件所在的目录不在系统的 PATH 环境变量中。

#### 解决：

检查 `claude` 安装位置。对于原生安装，它应该在 `~/.local/bin/claude`（Linux/macOS）或 `%USERPROFILE%\.local\bin\claude.exe`（Windows）。确保该目录在 PATH 中。如果不在，你可以通过修改 `~/.bashrc`、`~/.zshrc` 或系统环境变量来添加该路径。添加后，重新打开终端或运行 `source ~/.bashrc` 使其生效。然后再次尝试运行 `claude --version`，如果能输出版本号，说明问题已解决。

### 7.2 权限与认证问题

#### 问题：

Claude Code 频繁要求你确认同一个命令的执行权限，即使你之前已经选择过"Always allow"。

#### 原因：

这通常意味着该命令没有被正确地添加到允许列表，或者权限策略配置有误。

#### 解决：

首先，确保在提示时确实选择了"Always allow"（或"总是允许"）。如果你选择了，但下次仍然被询问，请检查你的权限设置。你可以运行 `/permissions` 命令查看当前的允许列表。确认你期望的命令或工具是否在其中。如果不在，可以使用 `/permissions` 将其添加。例如，`/permissions allow Edit` 可以让文件编辑工具不经确认直接执行。如果你使用的是团队共享的配置，确保团队配置中该命令没有被禁用。如果问题依旧，可以尝试重置权限配置或检查是否有多个配置文件相互覆盖。例如，全局配置可能允许某命令，但项目配置中又禁用了它，导致项目环境下仍然需要确认。

#### 问题：

Claude Code 提示认证失败或无法登录。

#### 原因：

这可能是由于账户信息无效、网络问题或认证令牌过期导致的。

#### 解决：

首先，确保你的 Claude 订阅或 Console 账户是有效且有额度的。如果使用的是 Console 账户，检查 API 密钥是否正确且未过期。你可以尝试在 Claude Console 网站上手动登录，确认账户状态正常。如果账户正常，尝试在 Claude Code 中重新登录：运行 `/logout` 退出当前账户，然后重新运行 `claude` 并按照提示登录。如果仍然无法登录，请检查网络连接，确保能够访问 Anthropic 的服务器。如果网络正常但问题依旧，可以尝试删除本地的认证缓存文件（例如 `~/.config/claude-code/auth.json`），然后重新登录。如果问题持续，可能是服务端的问题，可以稍后重试或联系 Anthropic 支持。

#### 问题：

Claude Code 提示权限不足，无法执行某命令，即使你明明有权限执行。

#### 原因：

这可能是由于权限策略配置过于严格，或者配置文件中禁用了该工具或命令。

#### 解决：

检查你的权限设置。运行 `/permissions` 查看哪些命令被禁用或需要确认。如果发现某个工具被禁用（例如 `Bash` 工具被禁用），你可以根据需要启用它。你也可以查看 `settings.json` 中的 `permissions` 部分，确认没有误将常用工具列入拒绝列表。如果团队配置中有严格的权限控制，你可能需要联系团队管理员调整策略。在个人环境中，你可以尝试将权限模式设置为 Normal（非 Plan 模式），因为 Plan 模式下所有写操作默认是被禁止的。如果问题依然存在，请确认该命令在你系统上确实有执行权限（例如，尝试在终端中直接运行该命令，看是否成功）。如果系统权限都正常，但 Claude Code 仍然拒绝，那可能是配置问题，需要调整配置或重启 Claude Code 使配置生效。

### 7.3 配置文件问题

#### 问题：

Claude Code 没有按照预期的配置工作，例如没有加载某个自定义斜杠命令，或者权限设置未生效。

#### 原因：

这可能是由于配置文件放置位置不正确、格式错误，或者配置文件的加载顺序导致的覆盖问题。

#### 解决：

首先，确认配置文件的位置是否符合预期。用户全局配置应该在 `~/.claude/` 目录下，项目配置应该在项目根目录的 `.claude/` 目录下。检查文件名是否正确（例如 `settings.json` 而不是 `setting.json`）。然后，检查文件格式是否正确。JSON 文件必须符合 JSON 语法，常见的错误包括多余的逗号、引号不匹配等。你可以使用 JSON 验证工具或编辑器来验证 JSON 语法。如果语法正确但仍未生效，可能是配置被其他文件覆盖了。Claude Code 会按照**托管 > 本地 > 项目 > 用户**的优先级合并配置。因此，如果项目配置和用户配置冲突，项目配置会覆盖用户配置。确保没有高优先级的配置覆盖了你期望的设置。你可以尝试使用 `/config` 打开设置界面，查看当前生效的配置值，以确认哪些设置被应用了。如果问题依旧，可以尝试删除或重命名有问题的配置文件，让 Claude Code 使用默认设置，然后逐步恢复配置，定位问题所在。

#### 问题：

自定义斜杠命令没有出现在命令列表中，或者调用时报错。

#### 原因：

可能是命令文件路径不对、文件扩展名错误，或者命令文件内容格式不符合要求。

#### 解决：

首先，确认命令文件放置的位置。项目命令应该在 `.claude/commands/` 下，个人命令应该在 `~/.claude/commands/` 下。检查文件名是否以 `.md` 结尾，并且文件名即为命令名（例如 `deploy.md` 对应命令 `/deploy`）。如果文件路径和名称都正确，检查文件内容是否为有效的 Markdown 文本，并且没有特殊的语法错误。命令文件中可以包含提示词，但不能包含 Claude Code 无法识别的指令。确保文件没有被设置为隐藏属性或权限不允许读取。如果命令包含参数（`$ARGUMENTS` 或 `$1` 等），确认你在调用时提供了相应的参数。如果问题依旧，可以尝试在命令文件中写一些简单的文本（例如"Hello"），然后调用该命令，看 Claude Code 是否输出"Hello"。如果连最简单的命令都不工作，可能是配置或环境问题，需要进一步排查。如果简单命令可以工作，那么问题可能出在命令文件的内容上，可以尝试逐步添加内容定位问题。

#### 问题：

钩子（Hooks）没有按照预期执行，或者执行时报错。

#### 原因：

钩子脚本路径错误、语法错误，或者钩子配置不正确。

#### 解决：

首先，确认钩子配置文件的位置和格式。用户钩子应该在 `~/.claude/hooks.json`，项目钩子应该在 `.claude/hooks.json`。检查 JSON 格式是否正确，确保每个钩子事件名称拼写正确（例如 `PreToolUse`、`PostToolUse` 等，注意大小写）。然后，检查钩子脚本路径是否正确，脚本是否有执行权限。如果脚本需要参数，确保在配置中正确传递了参数。你可以手动运行钩子脚本，看是否能正常执行，从而排除脚本本身的问题。如果脚本可以独立运行，但在 Claude Code 中不执行，可能是事件没有触发。例如，你配置了 `PostToolUse.Edit` 钩子，但 Claude Code 修改文件时没有触发它，这可能是由于权限模式的问题（Plan 模式下不会触发写操作钩子）。另外，检查是否有其他钩子配置覆盖了你的设置。如果问题依旧，可以尝试简化钩子配置，例如先只配置一个简单的 echo 命令，确认钩子机制本身正常，然后再逐步加入复杂逻辑。如果连最简单的钩子都不执行，可能需要检查 Claude Code 的日志或重启 Claude Code 以使配置生效。

### 7.4 性能与稳定性问题

#### 问题：

Claude Code 运行时占用 CPU 或内存过高，导致系统变慢。

#### 原因：

Claude Code 在处理大型代码库或复杂请求时，可能需要进行大量的分析和计算，这会占用系统资源。另外，如果开启了过多的 MCP 服务器连接或插件，也可能增加资源消耗。

#### 解决：

首先，确认你的硬件配置是否满足运行 Claude Code 的要求。如果系统资源本就紧张，可以考虑优化配置或减少并发使用。你可以尝试以下优化措施：

- **限制上下文范围：**在提问或配置中，尽量限定 Claude Code 需要关注的文件和目录范围，避免让它一次性读取整个代码库。
- **关闭不必要的功能：**如果你发现某个 MCP 服务器或插件导致资源占用高，可以暂时禁用它，看是否有所改善。
- **使用更轻量的模型：**在 `settings.json` 中，你可以选择使用更快的模型（如 Haiku）来处理某些任务，虽然功能稍弱，但资源消耗更低。
- **分批处理：**对于非常大的任务，考虑分批进行，避免一次性请求过多操作。
- **更新版本：**确保你使用的是最新版本的 Claude Code。新版本可能优化了性能和内存使用。你可以运行 `claude update` 来更新。
- **检查日志：**如果资源占用高持续存在，可以查看 Claude Code 的日志（如果有）或与 Anthropic 支持联系，获取进一步的帮助。

#### 问题：

Claude Code 命令执行时长时间无响应（挂起）。

#### 原因：

这可能是由于 Claude Code 正在等待用户输入、网络请求超时，或者进入了某种死锁状态。

#### 解决：

首先，确认是否 Claude Code 在等待你确认某些操作。在 Normal 模式下，Claude Code 在执行某些命令前会征求你的许可，如果你没有注意到提示，它就会一直等待。检查终端输出，看是否有需要你确认的提示。如果有，请按照提示输入 `y` 或 `n` 来继续。如果没有提示但命令一直挂起，可能是网络请求超时（例如正在等待模型响应）。你可以尝试按 `Ctrl+C` 中断当前命令，然后重试。如果重试仍然挂起，可能是网络问题或服务端问题，可以稍后再试。如果问题持续，可以尝试检查你的网络连接或更换网络环境。另外，确保没有其他进程占用大量资源导致系统整体响应缓慢。如果以上都无法解决，可能需要重启 Claude Code 或重启终端会话。

#### 问题：

Claude Code 崩溃或异常退出。

#### 原因：

软件崩溃可能由于多种原因，包括代码 Bug、系统兼容性问题或资源耗尽等。

#### 解决：

首先，尝试重新启动 Claude Code，看是否是临时性的问题。如果崩溃频繁发生，请检查系统和 Claude Code 的日志（如果有）以获取错误信息。如果你使用的是最新版本，可以尝试回退到之前的稳定版本，看是否新版本引入了兼容性问题。如果怀疑是资源耗尽导致的崩溃，可以参考上文优化资源使用的方法。如果问题依然存在，建议向 Anthropic 提交 Bug 报告。你可以使用 Claude Code 内置的 `/bug` 命令来提交 Bug，这会将当前对话的上下文发送给 Anthropic 支持团队。在报告中，请尽量详细地描述崩溃发生的场景、你之前执行的操作以及系统环境信息，这将有助于他们定位和修复问题。

### 7.5 搜索与发现相关问题

#### 问题：

Claude Code 在 WSL 环境下搜索或读取文件时速度很慢，或者无法找到某些文件。

#### 原因：

WSL 在访问 Windows 文件系统时性能可能较差，尤其是频繁地搜索或读取大量小文件时。另外，如果项目文件位于网络驱动器或挂载的 Windows 目录，也可能导致性能问题。

#### 解决：

首先，尝试将项目代码放在 Linux 文件系统中（例如在 WSL 的 `~/` 目录下），而不是 Windows 的 `C:\` 盘。如果必须放在 Windows 文件系统中，可以考虑使用符号链接将项目链接到 Linux 目录，或者将经常访问的文件复制到 Linux 目录。另外，可以减少需要搜索或读取的文件数量，通过配置限制 Claude Code 只关注必要的目录。你也可以尝试提高 WSL 的性能，例如关闭 Windows 防病毒软件对 WSL 文件的实时扫描，或者在 WSL 配置中启用 `metadata` 选项（如果适用）。如果问题依旧，可以尝试使用原生的 Linux 环境而非 WSL，来排除 WSL 本身的限制。

#### 问题：

Claude Code 找不到某个文件或代码，即使你知道它存在于代码库中。

#### 原因：

这可能是由于文件路径问题、Claude Code 的搜索限制，或者文件未被索引/加载到上下文中。

#### 解决：

首先，确认文件路径是否正确。在对话中，你可以使用 `@filename` 的语法明确指定某个文件，例如 `@src/utils/helpers.js`，让 Claude Code 读取该文件。如果文件路径较长或包含空格，请确保正确转义或引用。如果你使用的是 Plan 模式，它不会自动读取文件内容，你需要明确提示读取。如果问题依然，可能是 Claude Code 的上下文限制导致它无法同时关注太多文件。你可以尝试将问题分解，让 Claude Code 先关注一部分文件，然后再扩展范围。另外，检查项目的 `.gitignore` 或 Claude Code 的配置，确认没有忽略该文件。如果文件被忽略，你可能需要调整配置或直接使用 `@` 引用。如果问题依旧，可以尝试重启 Claude Code 或使用 `/clear` 清除对话历史，然后重新询问，看是否能找到文件。

### 7.6 IDE 集成相关问题

#### 问题：

在 JetBrains IDE（如 IntelliJ IDEA、PyCharm）中安装了 Claude Code 插件，但插件无法正常工作或无法连接到 Claude Code。

#### 原因：

这可能是由于 IDE 插件配置错误、Claude Code 未正确运行，或网络问题导致的。

#### 解决：

首先，确保 Claude Code 本身可以在终端中正常运行。在终端中运行 `claude --version`，确认有版本号输出，说明 CLI 工作正常。然后，在 IDE 中检查插件的设置。通常，IDE 插件需要知道 Claude Code 的可执行文件路径或监听的端口。确保路径或端口配置正确。如果插件需要连接到 Claude Code 的服务器，请检查 Claude Code 是否已经启动并监听在预期的端口上。如果使用的是 JetBrains 的远程开发功能（如通过 SSH 连接到远程 WSL 或容器），确保 Claude Code 在目标环境中可运行。网络方面，如果插件需要通过网络调用 Claude Code API，确保 IDE 所在机器可以访问 Anthropic 的服务或你的代理服务器。如果问题依旧，可以尝试重启 IDE 和 Claude Code，或者查看 IDE 的插件日志获取更多信息。如果怀疑是插件 Bug，可以尝试更新插件到最新版本或向插件开发者报告问题。

#### 问题：

在 JetBrains IDE 的终端中使用 Claude Code 时，某些快捷键（如 Esc 键）不起作用或行为异常。

#### 原因：

这通常是由于 IDE 终端的键映射设置与 Claude Code 的快捷键冲突导致的。

#### 解决：

检查 IDE 的终端设置，确保没有将 Esc 键映射为其他用途。在 IntelliJ IDEA 中，可以在 Settings > Keymap 中搜索 “Escape”，看是否有快捷键绑定到它。如果有冲突，可以禁用或更改该绑定。另外，有些 IDE 终端支持模拟不同的终端类型，你可以尝试在设置中将终端类型设置为 “xterm” 或 “vt100”，看看是否解决问题。如果 Esc 键在 Claude Code 中用于特定功能（例如退出某种模式），而 IDE 拦截了它，你也可以考虑在 Claude Code 中使用其他替代方式完成该操作，或者修改 IDE 的快捷键映射以避免冲突。

#### 问题：

Claude Code 在集成终端中显示乱码或不支持某些 Unicode 字符。

#### 原因：

这可能是由于终端编码设置不正确或字体不支持导致。

#### 解决：

确保你的终端使用 UTF-8 编码。在 Linux/macOS 上，可以在 `~/.bashrc` 或 `~/.zshrc` 中添加 `export LANG=en_US.UTF-8`（或你偏好的语言环境）。在 Windows 上，可以尝试使用支持 Unicode 的终端（如 Windows Terminal，而非旧版命令提示符）。另外，检查终端字体是否支持 Unicode 字符（如中文、特殊符号等）。如果显示乱码，可以尝试更换一种支持更广泛 Unicode 的字体。如果问题依旧，可以尝试更新终端或 Claude Code 到最新版本，因为新版本可能修复了编码相关的 Bug。

### 7.7 其他问题

#### 问题：

Claude Code 输出的代码块缺少语言标签或格式不正确，导致在编辑器中显示不佳。

#### 原因：

这可能是由于输出过长被截断，或者 Markdown 渲染问题。

#### 解决：

如果代码块很长，可以尝试让 Claude Code 分段输出，或者使用 `/compact` 命令精简对话历史，减少 token 消耗。确保你的终端或编辑器支持 Markdown 语法高亮。有些情况下，Claude Code 可能没有正确识别代码语言，你可以明确提示它"使用 Python 输出代码块"来帮助识别。如果问题依然，可能是终端渲染的问题，可以尝试复制输出到支持 Markdown 的编辑器中查看。如果确认是 Claude Code 的输出问题，可以考虑向 Anthropic 反馈，以便他们改进 Markdown 输出格式。

#### 问题：

Claude Code 的提示信息或帮助文档显示不完整或有乱码。

#### 原因：

这可能是由于终端编码设置不当或 Claude Code 的本地化资源问题。

#### 解决：

确保终端使用 UTF-8 编码，如上文所述。如果使用的是非英语界面，尝试在 Claude Code 中切换语言或使用英文界面，看是否改善。如果问题依旧，可以尝试更新 Claude Code 到最新版本，因为新版本可能修复了显示相关的 Bug。如果怀疑是字体问题，更换一种支持更多字符的字体试试。如果问题依然存在，可以考虑在 Anthropic 的社区或支持渠道报告此问题。

在遇到任何未列出的问题时，请记住 **“大多数 Claude Code 问题都有简单的解决方案”**。先从基础开始检查：重启 Claude Code、检查命令路径和权限、确认网络和账户状态。如果这些基本步骤都无法解决，再考虑更深入的调查。你也可以借助官方文档、社区论坛或 Discord 社区寻求帮助。在报告问题时，尽量提供详细的错误信息和复现步骤，这将有助于他人快速定位问题。通过耐心和合理的排查，大多数问题都可以迎刃而解。

## 8. 总结

Claude Code 作为一款智能的命令行编程助手，正日益成为开发者不可或缺的伙伴。它不仅能够执行繁琐的日常任务，还能解释复杂的代码逻辑、管理 Git 工作流程，甚至主动提问来澄清需求，从而让编程工作变得前所未有的高效和轻松。

在本教程中，我们全面介绍了 Claude Code 的安装配置、基本使用流程、常见工作流程，以及高级功能和最佳实践。从快速启动一个会话，到使用斜杠命令和钩子定制你的工作流，再到利用 MCP 连接外部工具，我们逐步深入，帮助你构建对 Claude Code 的完整认识。

Claude Code 的强大之处在于其灵活性和可扩展性。无论你是个人开发者还是团队成员，都可以根据自己的需求定制 Claude Code，使其成为你个人编码风格的延伸或团队开发流程的一部分。通过遵循本教程介绍的最佳实践，你可以最大限度地发挥 Claude Code 的潜力，同时保持对代码质量和安全性的掌控。

当然，掌握 Claude Code 也是一个持续学习和实验的过程。随着 Anthropic 不断推出新功能和改进，以及你自身项目的演进，你可能会发现新的用法和优化空间。保持开放的心态，尝试不同的配置和工作流，并从社区中汲取经验，这将让你和团队始终处于高效开发的前沿。

总之，Claude Code 将 AI 的智能带入了编程的日常，使"像与同事对话一样编码"成为现实。通过本教程的学习，相信你已经具备了在自己的项目中熟练使用 Claude Code 的能力。现在，就打开终端，启动 Claude Code，开始享受它为你带来的编程变革吧！祝你编码愉快，创意无限！